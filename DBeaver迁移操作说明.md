# 用 DBeaver 执行 SQL 迁移

## 一、迁移脚本说明

- **文件**：项目根目录下的 `migrate_plan_groups_is_public.sql`
- **作用**：给 `plan_groups` 表增加字段 `is_public`，用于「总套餐是否在套餐列表展示」
- **特点**：只做 `ALTER TABLE`，不删表、不删数据，只加一列，默认值为 1（展示）
- **重复执行**：若该列已存在，会报错「Duplicate column name 'is_public'」，说明已迁移过，可忽略

---

## 二、DBeaver 操作步骤

### 1. 连接数据库

1. 打开 DBeaver，在左侧「数据库导航」里找到你的 MySQL 连接（或新建连接）。
2. 新建连接时：选 MySQL → 填主机、端口（一般 3306）、库名、用户名、密码 → 测试连接 → 完成。
3. 展开该连接 → 展开「数据库」→ 选中你要执行迁移的**数据库**（例如 `proxy` 或你实际使用的库名）。

### 2. 打开 SQL 编辑器

- **方式 A**：选中该数据库 → 右键 → **SQL 编辑器** → **打开 SQL 脚本** → 选项目里的 `migrate_plan_groups_is_public.sql`。
- **方式 B**：菜单 **SQL 编辑器** → **新建 SQL 脚本** → 在编辑器里**复制粘贴** `migrate_plan_groups_is_public.sql` 的全部内容。

确认编辑器**当前数据库**是你要迁移的库（窗口标题或下拉里会显示库名）。

### 3. 执行迁移

1. 在 SQL 编辑器里，用鼠标**选中**要执行的那一段（一般是整段 `ALTER TABLE ...`），或直接不选中则执行全部。
2. 执行方式任选其一：
   - **Ctrl + Enter**（Windows/Linux）或 **Cmd + Enter**（Mac）：执行当前语句或选中部分。
   - 或点工具栏里的 **执行** 按钮（三角形图标）。
3. 看下方「输出」或「日志」：
   - 显示 **完成 / 成功** 或 **0 row(s) affected**：说明迁移成功，`plan_groups` 已多出 `is_public` 列。
   - 若报 **Duplicate column name 'is_public'**：说明之前已经执行过，无需再执行，可忽略。

### 4. 可选：检查是否生效

1. 在左侧展开：你的数据库 → **表** → 找到 **plan_groups**。
2. 右键 **plan_groups** → **查看表** 或 **编辑表**，在列列表里应能看到 **is_public**，类型为 TINYINT，默认 1。

---

## 三、安全建议（避免误动数据库）

1. **先备份**：在 DBeaver 里对目标数据库右键 → **备份/导出** → 按提示导出（或使用 mysqldump），再执行迁移。
2. **只执行迁移脚本**：不要在该窗口里顺手执行其它不熟悉的 SQL，避免误删、误改。
3. **确认库名**：执行前再看一眼编辑器顶部的「当前数据库」，确保不是生产库以外的库。
4. **重复执行**：本迁移可重复执行不会改数据，只是第二次会报「列已存在」，属正常。

---

## 四、若没有 DBeaver

- **命令行**：在项目根目录执行（把 `数据库名`、`-u`、`-p` 换成你的）：  
  `mysql -u 用户名 -p 数据库名 < migrate_plan_groups_is_public.sql`
- **其它客户端**：用 Navicat、MySQL Workbench 等打开该 SQL 文件，选中并执行其中的 `ALTER TABLE` 语句即可。
